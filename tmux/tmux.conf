################################################################################
################################### Custom colors ##############################
################################################################################
#set -g @tmux_power_theme '#ca78e3'
################################################################################
################################### Plugins ####################################
################################################################################
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins/'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'alexteal/tmux-powerline'
#set -g @plugin 'wfxr/tmux-power'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# copy goes to system clipboard
set -g @plugin 'tmux-plugins/tmux-yank'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

# prefix highlighter
# 'L' for left only, 'R' for right only and 'LR' for both
#set -g @tmux_power_prefix_highlight_pos 'LR'
################################################################################
################################################################################
################################### Powerline defaults #########################
################################################################################
set-option -g status on
set-option -g status-interval 2
set-option -g status-justify "centre"
set-option -g status-left-length 60
set-option -g status-right-length 90
set-option -g status-left "#(~/.tmux/plugins/tmux-powerline/powerline.sh left)"
set-option -g status-right "#(~/.tmux/plugins/tmux-powerline/powerline.sh right)"
set-hook -g session-created 'run-shell "~/.tmux/plugins/tmux-powerline/powerline.sh init"' # prettifies the window-status segments
################################################################################
################################### Keybinds ###################################
################################################################################
# set source file keybind
bind r source-file ~/.tmux.conf

# allow window resizing with mouse
set -g mouse on 

#custom bind to allow nested commands
set-option -g prefix C-Space

bind-key C-Space send-prefix

bind S split-window -v -c "#{pane_current_path}"
bind D split-window -h -c "#{pane_current_path}"
bind h select-pane -L
bind l select-pane -R
bind k select-pane -U
bind j select-pane -D

bind g new-window -c "#{pane_current_path}" "lazygit"
bind F new-window -c "#{pane_current_path}" 'cat $( find . -maxdepth 2 ) 2>/dev/null | fzf'

#destroy current session, move to next session in order
bind Q run-shell "~/.scripts/tmux-kill-session.sh"

#split windows start with same directory
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# this fixes bad backspace behavior
#set -g default-terminal "xterm-256color"
#set -g terminal-overrides ',xterm-256color:Tc'
#set -as terminal-overrides ',xterm*:sitm=\E[3m'
# vim style keybinds
setw -g mode-keys vi
################################################################################
########################## Nested Session Control ##############################
################################################################################
# SSH Specific settings
#set nested window control
if-shell -b '[ -n "$SSH_CLIENT" ]' "\
        set-option -g prefix2 C-b;\
        set -g window-style 'fg=colour255,bg=colour235';\
        set -g window-active-style 'fg=colour255,bg=colour234';\
        set -g pane-active-border-style 'fg=colour68 bg=colour68'"

# Overrides for specific machines over SSH
# Sets different tmux command keybind, but ctrl-space twice still works. 

# Work 
if-shell -b '[ $TMUX_PRIORITY = 0 ] && [ -n "$SSH_CLIENT" ]' "\
        set-option -g prefix2 C-b;\
        bind-key C-b send-prefix;\ "
# Server
if-shell -b '[ $TMUX_PRIORITY = 1 ] && [ -n "$SSH_CLIENT" ]' "\
        set-option -g prefix2 C-b;\
        bind-key C-b send-prefix;\ "
# Personal
if-shell -b '[ $TMUX_PRIORITY = 2 ] && [ -n "$SSH_CLIENT" ]' "\
        set-option -g prefix2 `;\
        bind-key ` send-prefix;\ "
